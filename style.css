/* js/style.css - SnugOS Stylesheet with Light/Dark Theme */

/* --- CSS Custom Properties for Theming --- */
:root {
    /* Light Theme (Default) */
    --font-family: 'Inter', sans-serif;
    
    --bg-base: #f4f7f9; 
    --bg-desktop: #e9edf0; 
    --bg-window: #ffffff; 
    --bg-window-title-bar: #f0f3f5; 
    --bg-window-content: #ffffff; 
    --bg-taskbar: #d1d8e0; 
    --bg-start-menu: #ffffff;
    --bg-button: #e9edf0;
    --bg-button-hover: #d1d8e0;
    --bg-button-active: #b8c2cc;
    --bg-input: #ffffff;
    --bg-input-focus: #ffffff;
    --bg-dropzone: #f8f9fa;
    --bg-dropzone-dragover: #e9ecef;
    --bg-pad-button: #f1f3f5;
    --bg-pad-button-hover: #e9ecef;
    --bg-pad-button-active: #dee2e6;
    --bg-sequencer-grid: #fdfdff; 
    --bg-sequencer-header: #e9edf0;
    --bg-sequencer-label: #e9edf0;
    --bg-sequencer-step-light: #ffffff;
    --bg-sequencer-step-dark: #f1f3f5;
    --bg-sequencer-step-hover: #dbe4ff; 
    --bg-modal-overlay: rgba(0, 0, 0, 0.3);
    --bg-modal-dialog: #ffffff;
    --bg-modal-title-bar: #f1f3f5;
    --bg-context-menu: #ffffff;
    --bg-context-menu-hover: #007bff; 
    --bg-waveform: #ffffff;
    --bg-meter-container: #e9ecef;

    --text-primary: #212529; 
    --text-secondary: #495057; 
    --text-muted: #6c757d; 
    --text-title-bar: #343a40;
    --text-button: #212529;
    --text-button-hover: #000000;
    --text-input: #212529;
    --text-placeholder: #6c757d;
    --text-pad-label: #495057;
    --text-sequencer-header: #495057;
    --text-sequencer-label: #343a40;
    --text-sequencer-step: #6c757d;
    --text-context-menu: #212529;
    --text-context-menu-hover: #ffffff;
    --text-context-menu-disabled: #adb5bd;

    --border-primary: #ced4da; 
    --border-window: #adb5bd; 
    --border-window-title-bar: #ced4da;
    --border-button: #adb5bd;
    --border-button-active: #6c757d;
    --border-input: #ced4da;
    --border-input-focus: #80bdff; 
    --border-dropzone: #adb5bd;
    --border-dropzone-dragover: #007bff;
    --border-pad-button: #ced4da;
    --border-pad-button-selected: #007bff;
    --border-sequencer: #dee2e6;
    --border-modal: #adb5bd;
    --border-context-menu: #ced4da;
    --border-context-menu-separator: #e9ecef;
    --border-meter-container: #adb5bd;

    --shadow-window: 0px 2px 10px rgba(0,0,0,0.08);
    --shadow-start-menu: 2px 2px 8px rgba(0,0,0,0.1);
    --shadow-modal: 0px 5px 15px rgba(0,0,0,0.15);
    --shadow-context-menu: 1px 1px 5px rgba(0,0,0,0.08);
    --shadow-button-inset: inset 0 1px 1px rgba(255,255,255,0.7), inset 0 -1px 1px rgba(0,0,0,0.05);
    --shadow-button-active-inset: inset 0 1px 2px rgba(0,0,0,0.15), inset 0 -1px 0 rgba(255,255,255,0.2);

    --accent-primary: #007bff; 
    --accent-secondary: #6c757d; 
    --accent-success: #28a745; 
    --accent-danger: #dc3545; 
    --accent-warning: #ffc107; 
    --accent-info: #17a2b8; 

    /* Transport Button Specific Colors - Light Theme */
    --bg-button-play: var(--accent-success);
    --bg-button-play-hover: #218838; /* Darker green */
    --bg-button-stop: var(--accent-warning);
    --bg-button-stop-hover: #e0a800; /* Darker yellow */
    --bg-button-record: var(--accent-danger);
    --bg-button-record-hover: #c82333; /* Darker red */
    --bg-button-record-active: #a71d2a; /* Even darker red for active recording */
    --text-button-icon: #ffffff; /* White icons on colored buttons */


    --sequencer-active-synth: var(--accent-primary); 
    --sequencer-active-sampler: var(--accent-info);
    --sequencer-active-drum: var(--accent-success);
    --sequencer-active-instrument: #fd7e14; 
    --sequencer-playing-outline: var(--accent-warning);

    --waveform-color: var(--accent-primary);
    --meter-bar-color: var(--accent-info);
    --meter-bar-clipping-color: var(--accent-danger);

    --scrollbar-thumb: #adb5bd;
    --scrollbar-thumb-hover: #868e96;
    --scrollbar-track: #e9ecef;

    --top-taskbar-height: 32px;
    --bottom-taskbar-height: 32px;
    --timeline-track-name-width: 130px; 
    --timeline-track-name-bg: #f8f9fa; 
    --timeline-border-color: #ced4da;
    --timeline-ruler-bg: #e9ecef;
    --timeline-ruler-line-major: #adb5bd;
    --timeline-ruler-line-minor: #ced4da;
    --timeline-track-bg-odd: #f8f9fa;
    --timeline-track-bg-even: #ffffff;
    --timeline-playhead-color: var(--accent-danger);
    --audio-clip-bg: var(--accent-info);
    --audio-clip-border: #117a8b; 
    --sequence-clip-bg: var(--accent-primary); 
    --sequence-clip-border: #0056b3; 
}

html.dark {
    /* Dark Theme Overrides */
    --bg-base: #121212; 
    --bg-desktop: #181818; 
    --bg-window: #1e1e1e; 
    --bg-window-title-bar: #2a2a2a; 
    --bg-window-content: #181818; 
    --bg-taskbar: #1a1a1a; 
    --bg-start-menu: #1e1e1e;
    --bg-button: #3a3a3a;
    --bg-button-hover: #4a4a4a;
    --bg-button-active: #2a2a2a;
    --bg-input: #282828;
    --bg-input-focus: #303030;
    --bg-dropzone: #1c1c1c;
    --bg-dropzone-dragover: #2a2a2a;
    --bg-pad-button: #282828;
    --bg-pad-button-hover: #3a3a3a;
    --bg-pad-button-active: #202020;
    --bg-sequencer-grid: #121212; 
    --bg-sequencer-header: #1c1c1c;
    --bg-sequencer-label: #1c1c1c;
    --bg-sequencer-step-light: #161616; 
    --bg-sequencer-step-dark: #1e1e1e;  
    --bg-sequencer-step-hover: #2c2c2c; 
    --bg-modal-overlay: rgba(0,0,0,0.75);
    --bg-modal-dialog: #1e1e1e;
    --bg-modal-title-bar: #2a2a2a;
    --bg-context-menu: #2a2a2a;
    --bg-context-menu-hover: #0060c0; 
    --bg-waveform: #101010;
    --bg-meter-container: #101010;

    --text-primary: #e0e0e0; 
    --text-secondary: #b0b0b0;
    --text-muted: #888888;
    --text-title-bar: #f0f0f0; 
    --text-button: #e0e0e0;
    --text-button-hover: #ffffff;
    --text-input: #e0e0e0;
    --text-placeholder: #777777;
    --text-pad-label: #b0b0b0;
    --text-sequencer-header: #b0b0b0;
    --text-sequencer-label: #c0c0c0;
    --text-sequencer-step: #777777;
    --text-context-menu: #e0e0e0;
    --text-context-menu-hover: #ffffff;
    --text-context-menu-disabled: #555555;

    --border-primary: #3a3a3a;
    --border-window: #383838; 
    --border-window-title-bar: #121212; 
    --border-button: #1a1a1a;
    --border-button-active: #121212;
    --border-input: #4a4a4a;
    --border-input-focus: #60a5fa; 
    --border-dropzone: #4a4a4a;
    --border-dropzone-dragover: #5a5a5a;
    --border-pad-button: #404040;
    --border-pad-button-selected: #60a5fa;
    --border-sequencer: #2a2a2a;
    --border-modal: #3a3a3a;
    --border-context-menu: #484848;
    --border-context-menu-separator: #3a3a3a;
    --border-meter-container: #3a3a3a;

    --shadow-window: 0px 0px 15px rgba(0,0,0,0.5);
    --shadow-start-menu: 2px 2px 8px rgba(0,0,0,0.6);
    --shadow-modal: 2px 2px 10px rgba(0,0,0,0.7);
    --shadow-context-menu: 2px 2px 8px rgba(0,0,0,0.6);
    --shadow-button-inset: inset -1px -1px 1px rgba(0,0,0,0.3), inset 1px 1px 1px rgba(255,255,255,0.05);
    --shadow-button-active-inset: inset 1px 1px 1px rgba(0,0,0,0.4), inset -1px -1px 1px rgba(255,255,255,0.03);

    --accent-primary: #3b82f6; 
    --accent-secondary: #6b7280; 
    --accent-success: #22c55e; /* Brighter green for dark mode */
    --accent-danger: #ef4444; 
    --accent-warning: #f59e0b; 
    --accent-info: #06b6d4; 

    /* Transport Button Specific Colors - Dark Theme */
    --bg-button-play: var(--accent-success);
    --bg-button-play-hover: #16a34a; /* Darker green */
    --bg-button-stop: var(--accent-warning);
    --bg-button-stop-hover: #d97706; /* Darker amber */
    --bg-button-record: var(--accent-danger);
    --bg-button-record-hover: #dc2626; /* Darker red */
    --bg-button-record-active: #b91c1c; /* Even darker red for active recording */
    --text-button-icon: #ffffff; /* White icons on colored buttons */


    --sequencer-active-synth: #0ea5e9; 
    --sequencer-active-sampler: #14b8a6; 
    --sequencer-active-drum: #22c55e; 
    --sequencer-active-instrument: #f97316; 
    --sequencer-playing-outline: #eab308; 

    --waveform-color: var(--accent-info);
    --meter-bar-color: var(--accent-info);
    --meter-bar-clipping-color: var(--accent-danger);

    --scrollbar-thumb: #4a4a4a;
    --scrollbar-thumb-hover: #5a5a5a;
    --scrollbar-track: #1e1e1e;

    --timeline-track-name-bg: #2a2a2a;
    --timeline-border-color: #3a3a3a;
    --timeline-ruler-bg: #2a2a2a;
    --timeline-ruler-line-major: #555555;
    --timeline-ruler-line-minor: #444444;
    --timeline-track-bg-odd: #1e1e1e;
    --timeline-track-bg-even: #1a1a1a;
    --timeline-playhead-color: #00ffff; 
    --audio-clip-bg: #008080; 
    --audio-clip-border: #009090; 
    --sequence-clip-bg: #007acc; 
    --sequence-clip-border: #005fa3; 
}


/* --- SnugOS General & Desktop Styling --- */
body {
    font-family: var(--font-family); 
    font-size: 14px;
    margin: 0; 
    overflow: hidden; 
    background-color: var(--bg-base); 
    color: var(--text-primary); 
    transition: background-color 0.2s ease-out, color 0.2s ease-out;
}

#desktop {
    width: 100vw;
    height: 100vh;
    overflow: hidden; 
    position: relative; 
    background-color: var(--bg-desktop); 
    padding-top: var(--top-taskbar-height); 
    padding-bottom: var(--bottom-taskbar-height);
    box-sizing: border-box;
}

/* --- Window Styling --- */
.window {
    position: absolute; 
    border: 1px solid var(--border-window); 
    box-shadow: var(--shadow-window); 
    background-color: var(--bg-window); 
    display: flex; 
    flex-direction: column; 
    overflow: hidden; 
    min-width: 150px; 
    min-height: 100px;
    color: var(--text-primary); 
    border-radius: 6px; 
}

.window.minimized {
    display: none !important; 
}

.window-title-bar {
    background-color: var(--bg-window-title-bar); 
    color: var(--text-title-bar); 
    padding: 6px 12px; 
    cursor: grab;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 32px; 
    flex-shrink: 0; 
    font-size: 0.875rem; 
    font-weight: 500; 
    user-select: none; 
    border-bottom: 1px solid var(--border-window-title-bar); 
    border-top-left-radius: 5px; 
    border-top-right-radius: 5px;
}

.window-title-bar span { 
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding-right: 8px; 
}

.window-title-buttons {
    display: flex;
    gap: 6px; 
}

.window-title-buttons button {
    background: transparent; 
    border: 1px solid transparent; 
    color: var(--text-muted); 
    width: 24px; 
    height: 24px;
    line-height: 22px; 
    text-align: center;
    font-size: 14px; 
    font-weight: normal;
    padding: 0;
    cursor: default; 
    flex-shrink: 0;
    border-radius: 4px; 
    transition: background-color 0.15s ease, color 0.15s ease;
}

.window-title-buttons button:hover {
    background: var(--bg-button-hover); 
    color: var(--text-button-hover);
}

.window-title-buttons button:active {
    background: var(--bg-button-active); 
}

.window-content {
    flex-grow: 1; 
    padding: 0; 
    background-color: var(--bg-window-content); 
    overflow: auto; 
    color: var(--text-primary); 
    border-bottom-left-radius: 5px;
    border-bottom-right-radius: 5px;
}

/* --- Taskbar Styling (Top and Bottom) --- */
#taskbar, #topTaskbar {
    position: fixed;
    left: 0;
    width: 100%;
    height: var(--bottom-taskbar-height); 
    background-color: var(--bg-taskbar); 
    z-index: 10000; 
    display: flex;
    align-items: center;
    padding: 0 8px; 
    box-sizing: border-box;
    color: var(--text-secondary); 
    transition: background-color 0.2s ease-out, border-color 0.2s ease-out;
}
#taskbar { 
    bottom: 0;
    border-top: 1px solid var(--border-primary); 
}
#topTaskbar { 
    top: 0;
    height: var(--top-taskbar-height); 
    border-bottom: 1px solid var(--border-primary);
    justify-content: space-between; 
}

/* Theme Toggle Buttons in Top Taskbar */
#topTaskbar .theme-toggle-button { 
    background: transparent;
    border: none;
    padding: 4px;
    border-radius: 50%;
    cursor: pointer;
    color: var(--text-muted); 
    transition: background-color 0.2s ease, color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}
#topTaskbar .theme-toggle-button:hover {
    background-color: var(--bg-button-hover);
    color: var(--text-button-hover); 
}
#topTaskbar .theme-toggle-button svg {
    width: 18px; 
    height: 18px;
    stroke-width: 2; /* Ensure SVGs use this if not set inline */
}
/* Highlight active theme button */
html.dark #themeToggleDark,
html:not(.dark) #themeToggleLight {
    background-color: var(--accent-primary) !important; 
    color: white !important; 
}
html.dark #themeToggleDark svg,
html:not(.dark) #themeToggleLight svg {
    stroke: white; 
}

/* Transport buttons in top taskbar */
#topTaskbar #playBtnGlobal,
#topTaskbar #stopBtnGlobal,
#topTaskbar #recordBtnGlobal {
    background-color: var(--bg-button); /* Default themed background */
    color: var(--text-button-icon); /* Themed icon color */
    border: 1px solid var(--border-button);
    box-shadow: var(--shadow-button-inset);
}
#topTaskbar #playBtnGlobal { background-color: var(--bg-button-play); }
#topTaskbar #playBtnGlobal:hover { background-color: var(--bg-button-play-hover); }
#topTaskbar #stopBtnGlobal { background-color: var(--bg-button-stop); }
#topTaskbar #stopBtnGlobal:hover { background-color: var(--bg-button-stop-hover); }
#topTaskbar #recordBtnGlobal { background-color: var(--bg-button-record); }
#topTaskbar #recordBtnGlobal:hover { background-color: var(--bg-button-record-hover); }
#topTaskbar #recordBtnGlobal.recording-active { /* Class to be toggled by JS */
    background-color: var(--bg-button-record-active) !important;
    box-shadow: 0 0 8px var(--accent-danger), var(--shadow-button-active-inset) !important; /* Example: add a glow */
    animation: pulseRecord 1.5s infinite ease-in-out;
}

@keyframes pulseRecord {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.05); }
}


#startButton {
    background-color: var(--bg-button); 
    border: 1px solid var(--border-button);
    box-shadow: var(--shadow-button-inset);
    padding: 4px 12px; 
    font-weight: 500; 
    margin-right: 6px;
    color: var(--text-button); 
    border-radius: 4px;
    transition: background-color 0.15s ease;
}
#startButton:hover {
    background-color: var(--bg-button-hover);
}
#startButton:active {
    border-color: var(--border-button-active); 
    box-shadow: var(--shadow-button-active-inset);
    background-color: var(--bg-button-active);
}

#taskbarButtons .taskbar-button {
    background-color: var(--bg-button); 
    border: 1px solid var(--border-button);
    box-shadow: var(--shadow-button-inset);
    padding: 3px 10px; 
    margin: 0 3px;
    max-width: 160px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-size: 0.8rem;
    flex-shrink: 0; 
    color: var(--text-secondary); 
    border-radius: 4px;
    transition: background-color 0.15s ease, color 0.15s ease, box-shadow 0.15s ease;
}
#taskbarButtons .taskbar-button:hover {
    background-color: var(--bg-button-hover);
    color: var(--text-button-hover);
}
#taskbarButtons .taskbar-button.active,
#taskbarButtons .taskbar-button:active {
    border-color: var(--border-button-active);
    box-shadow: var(--shadow-button-active-inset);
    background-color: var(--bg-button-active); 
    color: var(--text-button-hover); 
}
#taskbarButtons .taskbar-button.minimized-on-taskbar {
    background-color: var(--bg-button); 
    opacity: 0.65; 
}

#taskbarTempoDisplay {
    margin-left: auto; 
    padding: 4px 10px;
    border: 1px solid var(--border-button);
    box-shadow: var(--shadow-button-inset);
    font-size: 0.8rem;
    background-color: var(--bg-button); 
    cursor: pointer;
    color: var(--text-secondary); 
    border-radius: 4px;
}
#taskbarTempoDisplay:hover {
    background-color: var(--bg-button-hover);
}

/* --- Start Menu Styling --- */
#startMenu {
    position: absolute;
    bottom: var(--bottom-taskbar-height); 
    left: 0;
    background: var(--bg-start-menu); 
    border: 1px solid var(--border-primary); 
    box-shadow: var(--shadow-start-menu);
    z-index: 10001; 
    padding: 6px; 
    min-width: 230px; 
    color: var(--text-primary); 
    border-radius: 5px; 
}

#startMenu.hidden { display: none; }
#startMenu ul { list-style: none; padding: 0; margin: 0; }
#startMenu li { padding: 8px 20px 8px 15px; cursor: pointer; font-size: 0.875rem; white-space: nowrap; color: var(--text-primary); border-radius: 4px; transition: background-color 0.1s ease, color 0.1s ease;}
#startMenu li:hover, #startMenu li.disabled:hover { background: var(--bg-context-menu-hover); color: var(--text-context-menu-hover); } 
#startMenu li.disabled { color: var(--text-context-menu-disabled); cursor: default; }
#startMenu hr { border: none; border-top: 1px solid var(--border-context-menu-separator); margin: 5px 0; }


/* --- Pad Button Styling --- */
.pad-button {
    padding: 10px; 
    border: 1px solid var(--border-pad-button); 
    background-color: var(--bg-pad-button); 
    color: var(--text-secondary); 
    cursor: pointer;
    text-align: center;
    min-width: 75px; 
    min-height: 75px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-button-inset);
    transition: background-color 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    overflow: hidden; 
    position: relative; 
    border-radius: 5px; 
}
.pad-button:hover {
    background-color: var(--bg-pad-button-hover); 
    border-color: var(--border-pad-button-selected); 
}
.pad-button:active, .pad-button.selected-for-edit {
    background-color: var(--bg-pad-button-active); 
    box-shadow: var(--shadow-button-active-inset);
    border-color: var(--border-pad-button);
}
.pad-button.selected-for-edit {
    border-color: var(--border-pad-button-selected); 
    border-width: 2px;
    padding: 9px; 
}
.pad-label {
    font-size: 0.7rem; 
    color: var(--text-muted); 
    display: block;
    margin-top: 5px;
    word-break: break-all; 
    line-height: 1.2;
    max-height: 2.4em; 
    overflow: hidden;
    text-overflow: ellipsis;
}

/* --- General Drop Zone Styling --- */
.drop-zone {
    border: 2px dashed var(--border-dropzone); 
    padding: 12px;          
    text-align: center;
    background-color: var(--bg-dropzone);  
    color: var(--text-muted);            
    font-size: 0.85em; 
    border-radius: 5px;         
    margin-bottom: 8px;    
    transition: background-color 0.2s ease, border-color 0.2s ease;
}
.drop-zone.dragover {
    background-color: var(--bg-dropzone-dragover); 
    border-color: var(--border-dropzone-dragover);     
    color: var(--text-primary); 
}
.drop-zone label { color: var(--accent-primary); text-decoration: underline; cursor: pointer; }
.drop-zone label:hover { color: var(--accent-primary); filter: brightness(0.8); }


/* --- Knob Styling --- */
.knob-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 6px; 
    min-width: 65px; 
}
.knob-label {
    font-size: 0.75rem; 
    color: var(--text-secondary); 
    margin-bottom: 3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    text-align: center;
}
.knob {
    width: 40px; 
    height: 40px; 
    background-color: var(--bg-button); 
    border-radius: 50%;
    position: relative;
    border: 1px solid var(--border-button); 
    box-shadow: var(--shadow-button-inset), 0 1px 2px rgba(0,0,0,0.1); 
    cursor: ns-resize; 
}
.knob-handle {
    width: 4px; 
    height: 12px; 
    background-color: var(--text-muted); 
    position: absolute;
    top: 4px; 
    left: 50%;
    transform: translateX(-50%); 
    transform-origin: bottom center; 
    border-radius: 2px; 
}
.knob-value {
    font-size: 0.7rem; 
    color: var(--text-muted); 
    margin-top: 3px;
    min-height: 1.1em; 
    text-align: center;
}

/* --- General Button Active States --- */
button.muted { background-color: var(--accent-danger) !important; color: white !important; box-shadow: var(--shadow-button-active-inset) !important; }
button.soloed { background-color: var(--accent-warning) !important; color: var(--text-primary) !important; box-shadow: var(--shadow-button-active-inset) !important; }
button.armed { background-color: var(--accent-danger) !important; filter: brightness(1.2); color: white !important; box-shadow: var(--shadow-button-active-inset) !important; }
button.active { background-color: var(--accent-primary) !important; color: white !important; box-shadow: var(--shadow-button-active-inset) !important; }

/* --- Sequencer Grid Styling --- */
.sequencer-container .controls { 
    position: sticky;
    top: 0;
    left: 0; 
    background-color: var(--bg-window-title-bar); 
    z-index: 30; 
    border-bottom: 1px solid var(--border-window-title-bar);
    padding: 0.35rem 0.5rem; 
    color: var(--text-title-bar); 
}
.sequencer-container .controls input,
.sequencer-container .controls label {
    color: var(--text-input); 
}
.sequencer-container .controls input {
    background-color: var(--bg-input); 
    border-color: var(--border-input);
}

.sequencer-grid-layout {
    background-color: var(--bg-sequencer-grid); 
}

.sequencer-grid-layout > div {
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-size: 0.7rem; 
    border: 1px solid var(--border-sequencer); 
    border-radius: 2px; 
}

.sequencer-grid-layout .sequencer-header-cell {
    position: sticky;
    top: 0;
    background-color: var(--bg-sequencer-header); 
    font-weight: 500;
    color: var(--text-sequencer-header); 
    z-index: 20; 
}
.sequencer-grid-layout .sequencer-header-cell:first-child { 
    z-index: 25; 
    left: 0; 
}

.sequencer-grid-layout .sequencer-label-cell {
    position: sticky;
    left: 0;
    background-color: var(--bg-sequencer-label); 
    justify-content: flex-end;
    padding-right: 0.35rem; 
    font-weight: 500;
    color: var(--text-sequencer-label); 
    z-index: 10; 
}

.sequencer-grid-layout .sequencer-step-cell {
    cursor: pointer;
    transition: background-color 0.1s ease, transform 0.05s ease;
    color: var(--text-sequencer-step); 
}

.sequencer-step-cell.bg-gray-50 { background-color: var(--bg-sequencer-step-light); } 
.sequencer-step-cell.bg-white { background-color: var(--bg-sequencer-step-dark); }  

.sequencer-step-cell:hover {
    background-color: var(--bg-sequencer-step-hover) !important; 
    transform: scale(1.05); 
}

.sequencer-step-cell.active-synth,
.sequencer-step-cell.active-sampler,
.sequencer-step-cell.active-drum-sampler,
.sequencer-step-cell.active-instrument-sampler { 
    color: white !important; 
    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.2); 
} 
.sequencer-step-cell.active-synth { background-color: var(--sequencer-active-synth) !important; }
.sequencer-step-cell.active-sampler { background-color: var(--sequencer-active-sampler) !important; }
.sequencer-step-cell.active-drum-sampler { background-color: var(--sequencer-active-drum) !important; }
.sequencer-step-cell.active-instrument-sampler { background-color: var(--sequencer-active-instrument) !important; } 


.sequencer-step-cell.playing {
    outline: 2px solid var(--sequencer-playing-outline); 
    outline-offset: -1px; 
    z-index: 5; 
    transform: scale(1.1); 
}

/* --- Notification Area --- */
#notification-area { 
    position: fixed;
    top: calc(var(--top-taskbar-height) + 10px); 
    right: 10px;
    z-index: 20000; 
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.notification-message { 
    background-color: var(--bg-modal-overlay); 
    color: white; 
    padding: 12px 18px;
    border-radius: 5px;
    box-shadow: var(--shadow-modal);
    opacity: 0;
    transform: translateX(20px); 
    transition: opacity 0.3s ease, transform 0.3s ease;
    font-size: 0.9rem;
    max-width: 320px;
}
.notification-message.show { 
    opacity: 1;
    transform: translateX(0);
}

/* --- Waveform Canvas --- */
.waveform-canvas { 
    border: 1px solid var(--border-primary);
    background-color: var(--bg-waveform); 
    width: 100%; 
    height: 70px; 
    display: block; 
    border-radius: 3px;
}

/* --- Meter Bar Styling --- */
.meter-bar-container { 
    background-color: var(--bg-meter-container); 
    border-radius: 3px;
    overflow: hidden;
    border: 1px solid var(--border-meter-container);
    height: 10px; 
    box-sizing: border-box;
}
.meter-bar {
    background-color: var(--meter-bar-color); 
    height: 100%;
    width: 0%;
    transition: width 0.05s linear;
    border-radius: 2px; 
}
.meter-bar.clipping {
    background-color: var(--meter-bar-clipping-color); 
}
.track-meter-container { height: 16px; margin-top: 2px; }
.mixer-meter-container { height: 12px; margin-top: 4px; }
#masterMeterContainerGlobal, #mixerMasterMeterContainer { height: 15px; }

/* Modal Styling */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: var(--bg-modal-overlay); 
    display: flex; justify-content: center; align-items: center;
    z-index: 15000; 
}
.modal-dialog {
    background-color: var(--bg-modal-dialog); 
    border: 1px solid var(--border-modal); 
    box-shadow: var(--shadow-modal);
    min-width: 320px; max-width: 90%; max-height: 90vh; 
    display: flex; flex-direction: column;
    color: var(--text-primary); 
    border-radius: 6px; 
}
.modal-title-bar {
    background-color: var(--bg-modal-title-bar); 
    color: var(--text-title-bar);
    padding: 10px 15px; 
    font-weight: 500; font-size: 1rem; user-select: none;
    border-bottom: 1px solid var(--border-primary); 
    border-top-left-radius: 5px; 
    border-top-right-radius: 5px;
}
.modal-content-body { 
    padding: 20px; overflow-y: auto; flex-grow: 1;
    background-color: var(--bg-modal-dialog); 
    color: var(--text-primary); 
}
.modal-content-body p { margin-bottom: 12px; line-height: 1.6; }
.modal-content-body p:last-child { margin-bottom: 0; }

.modal-buttons {
    padding: 12px 15px; text-align: right;
    border-top: 1px solid var(--border-primary); 
    background-color: var(--bg-modal-title-bar); 
    border-bottom-left-radius: 5px;
    border-bottom-right-radius: 5px;
}
.modal-buttons button {
    background-color: var(--bg-button);
    border: 1px solid var(--border-button);
    box-shadow: var(--shadow-button-inset);
    color: var(--text-button);
    padding: 7px 18px; 
    margin-left: 10px; cursor: pointer; font-size: 0.875rem;
    border-radius: 4px;
    transition: background-color 0.15s ease, box-shadow 0.15s ease;
}
.modal-buttons button:hover {
    background-color: var(--bg-button-hover);
    box-shadow: var(--shadow-button-inset), 0 1px 2px rgba(0,0,0,0.05);
}
.modal-buttons button:active {
    border-color: var(--border-button-active); 
    box-shadow: var(--shadow-button-active-inset);
    background-color: var(--bg-button-active);
}
.modal-buttons button.confirm {
    background-color: var(--accent-primary);
    border-color: var(--accent-primary);
    color: white;
}
.modal-buttons button.confirm:hover {
    background-color: var(--accent-primary);
    filter: brightness(0.9);
}


/* Input and Select Styling */
select, input[type="text"], input[type="number"],
.window-content select, .modal-content-body select,
.window-content input[type="text"], .window-content input[type="number"],
.modal-content-body input[type="text"], .modal-content-body input[type="number"],
#topTaskbar input[type="number"], #topTaskbar select 
{
    background-color: var(--bg-input); 
    color: var(--text-input); 
    border: 1px solid var(--border-input); 
    padding: 6px 10px; 
    border-radius: 4px; 
    font-size: 0.875rem; 
    transition: border-color 0.15s ease, box-shadow 0.15s ease;
    line-height: 1.5; 
}
#topTaskbar input[type="number"], #topTaskbar select { 
    padding: 4px 8px;
    font-size: 0.8rem;
}

select:focus, input[type="text"]:focus, input[type="number"]:focus,
.window-content select:focus, .modal-content-body select:focus,
.window-content input[type="text"]:focus, .window-content input[type="number"]:focus,
.modal-content-body input[type="text"]:focus, .modal-content-body input[type="number"]:focus,
#topTaskbar input[type="number"]:focus, #topTaskbar select:focus {
    border-color: var(--border-input-focus);
    outline: 0;
    box-shadow: 0 0 0 0.15rem rgba(0,123,255,.2); 
}

input::placeholder, 
.window-content input::placeholder, .modal-content-body input::placeholder,
#topTaskbar input::placeholder {
    color: var(--text-placeholder); 
    opacity: 0.8;
}

/* Custom Scrollbar Styling */
::-webkit-scrollbar {
    width: 12px; 
    height: 12px; 
}
::-webkit-scrollbar-track {
    background: var(--scrollbar-track); 
    border-radius: 0px; 
}
::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb); 
    border-radius: 3px; 
    border: 2px solid var(--scrollbar-track); 
}
::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover); 
}
::-webkit-scrollbar-corner {
    background: var(--scrollbar-track); 
}
* { 
  scrollbar-width: thin; 
  scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track); 
}

/* --- Context Menu Styling --- */
.context-menu {
    background-color: var(--bg-context-menu); 
    border: 1px solid var(--border-context-menu);   
    box-shadow: var(--shadow-context-menu);
    padding: 5px 0; 
    min-width: 190px;
    border-radius: 5px; 
    color: var(--text-context-menu); 
    position: absolute; 
}

.context-menu ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.context-menu-item {
    padding: 8px 18px 8px 15px; 
    cursor: pointer;
    font-size: 0.875rem;
    white-space: nowrap;
    transition: background-color 0.1s ease, color 0.1s ease;
}

.context-menu-item:not(.disabled):hover {
    background-color: var(--bg-context-menu-hover); 
    color: var(--text-context-menu-hover);
}

.context-menu-item.disabled {
    color: var(--text-context-menu-disabled); 
    cursor: default;
}

.context-menu-separator {
    border: none;
    border-top: 1px solid var(--border-context-menu-separator); 
    margin: 5px 0;
}

/* --- Timeline Styling --- */
#timeline-container {
    height: 100%; 
    width: 100%;
    background-color: var(--bg-window-content); 
    display: flex;
    flex-direction: column;
    overflow: hidden; 
    position: relative;
}

#timeline-header {
    height: 24px; 
    background-color: var(--timeline-ruler-bg);
    border-bottom: 1px solid var(--timeline-border-color);
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
    width: 100%;
}

#timeline-ruler {
    width: 4000px; 
    height: 100%;
    background-image:
        repeating-linear-gradient(to right, var(--timeline-ruler-line-major) 0 1px, transparent 1px 100%),
        repeating-linear-gradient(to right, var(--timeline-ruler-line-minor) 0 1px, transparent 1px 100%);
    background-size: 120px 100%, 30px 100%; 
    background-position: left top; 
    position: absolute;
    top: 0;
}

#timeline-tracks-container {
    flex-grow: 1;
    overflow: auto; 
    position: relative;
    width: 100%;
    background-color: var(--bg-desktop); 
}

#timeline-tracks-area {
    width: 4000px; 
    position: relative;
    min-height: 100%; 
}

.timeline-track-lane {
    height: 64px; 
    border-bottom: 1px solid var(--timeline-border-color);
    box-sizing: border-box;
    position: relative;
    overflow: hidden; 
    display: flex; 
    align-items: stretch; 
}
.timeline-track-lane:nth-child(odd) {
    background-color: var(--timeline-track-bg-odd);
}
.timeline-track-lane:nth-child(even) {
    background-color: var(--timeline-track-bg-even);
}

.timeline-track-lane-name-area { 
    position: sticky;
    left: 0;
    z-index: 20; 
    background-color: var(--timeline-track-name-bg);
    padding: 0 10px; 
    height: 100%;
    display: flex;
    flex-direction: column; 
    align-items: flex-start;
    justify-content: center;
    border-right: 1px solid var(--timeline-border-color);
    min-width: var(--timeline-track-name-width);
    max-width: var(--timeline-track-name-width);
    box-sizing: border-box;
    box-shadow: 2px 0 3px -1px rgba(0,0,0,0.05); 
    html.dark & {
        box-shadow: 2px 0 3px -1px rgba(0,0,0,0.2);
    }
}
.timeline-track-name-text { 
    font-size: 0.875rem; 
    font-weight: 500;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
}
.timeline-sequence-buttons { 
    margin-top: 5px; 
}


#timeline-playhead {
    position: absolute;
    top: 0; 
    width: 2px;
    height: 100%; 
    background-color: var(--timeline-playhead-color);
    z-index: 40; 
    pointer-events: none;
    box-shadow: 0 0 5px var(--timeline-playhead-color); 
}

.audio-clip, .sequence-clip { 
    position: absolute;
    height: calc(80% - 2px); 
    top: 10%;
    border-radius: 4px; 
    box-sizing: border-box;
    overflow: hidden;
    color: white;
    font-size: 11px;
    padding: 3px 6px; 
    white-space: nowrap;
    text-overflow: ellipsis;
    cursor: grab;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
}
.audio-clip:hover, .sequence-clip:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}

.audio-clip {
    background-color: var(--audio-clip-bg);
    border: 1px solid var(--audio-clip-border);
}
.sequence-clip {
    background-color: var(--sequence-clip-bg);
    border: 1px solid var(--sequence-clip-border);
}
.audio-clip.dragging, .sequence-clip.dragging {
    opacity: 0.75;
    z-index: 50 !important; 
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}


#window-timeline .window-content {
    padding: 0;
}

.window.maximized #timeline-container,
.window.maximized #timeline-tracks-container {
    height: 100%;
}

/* Global control indicators in top taskbar */
#topTaskbar #midiIndicatorGlobal.active, 
#topTaskbar #keyboardIndicatorGlobal.active {
    background-color: var(--accent-info) !important;
    color: white !important;
    box-shadow: 0 0 8px var(--accent-info); 
}

