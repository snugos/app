/* --- SnugOS General & Desktop Styling --- */
body {
    font-family: 'Inter', sans-serif; 
    font-size: 14px;
    margin: 0; 
    overflow: hidden; 
    background-color: #101010; /* Very dark base background */
    color: #e0e0e0; /* Light grey default text for the entire application */
}

#desktop {
    width: 100vw;
    height: 100vh;
    overflow: hidden; 
    position: relative; 
    background-color: #101010; /* Consistent very dark desktop */
}

/* --- Window Styling (Unified Dark Theme) --- */
.window {
    position: absolute; 
    border: 1px solid #383838; /* Dark border, slightly lighter than deepest blacks */
    box-shadow: 0px 0px 15px rgba(0,0,0,0.5); /* Softer, more modern shadow */
    background-color: #1e1e1e; /* Main window background - very dark grey */
    display: flex; 
    flex-direction: column; 
    overflow: hidden; 
    min-width: 150px; 
    min-height: 100px;
    color: #e0e0e0; /* Default text color for windows */
    border-radius: 3px; /* Subtle rounding for a more modern feel */
}

.window.minimized {
    display: none !important; 
}

.window-title-bar {
    background-color: #2a2a2a; /* Slightly lighter dark for title bar */
    color: #cccccc; /* Lighter text for title bar */
    padding: 6px 8px; 
    cursor: move; 
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    border-top-left-radius: 2px; /* Match window rounding */
    border-top-right-radius: 2px;
    border-bottom: 1px solid #383838; /* Separator line */
    user-select: none; /* Prevent text selection when dragging */
}

.window-title-bar span {
    flex-grow: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-weight: 500;
    font-size: 0.9em;
}

.window-controls button {
    background: none; 
    border: none; 
    color: #aaaaaa; /* Lighter grey for controls */
    font-size: 16px; 
    padding: 0 5px; 
    cursor: pointer;
    line-height: 1; /* Ensure consistent button height */
}
.window-controls button:hover {
    color: #ffffff;
}
.window-controls button.close-btn:hover {
    color: #ff6b6b; /* Red for close hover */
}

.window-content {
    padding: 8px; 
    flex-grow: 1; 
    overflow: auto; /* Changed from scroll to auto for better behavior */
    background-color: #161616; /* Slightly darker content area for depth */
    border-bottom-left-radius: 2px; /* Match window rounding */
    border-bottom-right-radius: 2px;
}

.window-resize-handle {
    position: absolute;
    width: 10px;
    height: 10px;
    background: rgba(255,255,255,0.1); /* Subtle handle */
}
.resize-handle-se { bottom: 0; right: 0; cursor: nwse-resize; }
.resize-handle-sw { bottom: 0; left: 0; cursor: nesw-resize; }
.resize-handle-ne { top: 0; right: 0; cursor: nesw-resize; }
.resize-handle-nw { top: 0; left: 0; cursor: nwse-resize; }
.resize-handle-n { top: 0; left: 50%; transform: translateX(-50%); width: calc(100% - 16px); height: 8px; cursor: ns-resize; background: none;}
.resize-handle-s { bottom: 0; left: 50%; transform: translateX(-50%); width: calc(100% - 16px); height: 8px; cursor: ns-resize; background: none;}
.resize-handle-e { top: 50%; right: 0; transform: translateY(-50%); height: calc(100% - 16px); width: 8px; cursor: ew-resize; background: none;}
.resize-handle-w { top: 50%; left: 0; transform: translateY(-50%); height: calc(100% - 16px); width: 8px; cursor: ew-resize; background: none;}


/* --- Taskbar Styling --- */
#taskbar {
    position: fixed; 
    bottom: 0; 
    left: 0; 
    width: 100%; 
    height: 32px; /* Slimmer taskbar */
    background-color: #202020; /* Dark taskbar */
    border-top: 1px solid #383838; 
    display: flex; 
    align-items: center; 
    padding: 0 5px; 
    box-sizing: border-box;
    z-index: 10000; /* Ensure it's above windows */
    color: #cccccc;
}

#startButton {
    background-color: #0078D4; /* Windows-like blue */
    color: white; 
    border: none; 
    padding: 0 12px; 
    height: 26px; /* Fit nicely in taskbar */
    cursor: pointer; 
    font-weight: 500;
    border-radius: 2px;
    margin-right: 8px;
}
#startButton:hover {
    background-color: #005ba1;
}

#taskbarButtons {
    display: flex; 
    flex-grow: 1;
    height: 100%;
}
#taskbarButtons button {
    background-color: #333333; 
    color: #cccccc; 
    border: 1px solid #444444;
    border-bottom: none; /* Remove bottom border to "connect" with taskbar */
    padding: 0 10px; 
    margin-right: 3px; 
    cursor: pointer; 
    font-size: 0.85em;
    max-width: 150px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    border-top-left-radius: 2px;
    border-top-right-radius: 2px;
    height: calc(100% - 1px); /* Adjust to align with taskbar border */
    box-sizing: border-box;
}
#taskbarButtons button:hover {
    background-color: #404040;
}
#taskbarButtons button.active {
    background-color: #1e1e1e; /* Match window content background */
    border-color: #383838; /* Match window border */
    color: #ffffff;
}

#taskbarTempoDisplay {
    padding: 0 10px;
    font-size: 0.85em;
    color: #aaaaaa;
}

/* --- Start Menu Styling --- */
#startMenu {
    position: fixed; 
    bottom: 32px; /* Above taskbar */
    left: 0; 
    width: 220px; 
    background-color: rgba(30,30,30,0.95); /* Dark, slightly transparent */
    border: 1px solid #444444; 
    box-shadow: 0px -2px 10px rgba(0,0,0,0.3); 
    z-index: 9999; /* Below taskbar but above most windows */
    padding: 5px 0;
    border-radius: 3px;
    backdrop-filter: blur(5px); /* Frosted glass effect if browser supports */
}
#startMenu ul {
    list-style: none; 
    margin: 0; 
    padding: 0;
}
#startMenu li {
    padding: 8px 15px; 
    cursor: pointer; 
    color: #dddddd;
    font-size: 0.9em;
}
#startMenu li:hover {
    background-color: #0078D4; /* Highlight with Windows-like blue */
    color: white;
}
#startMenu li.disabled {
    color: #777777;
    cursor: default;
    background-color: transparent !important; /* Ensure no hover effect */
}
#startMenu hr {
    border: none;
    border-top: 1px solid #444444;
    margin: 5px 0;
}

/* --- Notification Area Styling --- */
#notification-area {
    position: fixed;
    bottom: 40px; /* Above taskbar */
    right: 10px;
    z-index: 10001; /* Above taskbar */
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}
.notification-message {
    background-color: rgba(50, 50, 50, 0.9); /* Dark, semi-transparent */
    color: #f0f0f0;
    padding: 10px 15px;
    margin-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    font-size: 0.85em;
    opacity: 0;
    transform: translateX(100%); /* Start off-screen */
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    max-width: 300px;
}
.notification-message.show {
    opacity: 1;
    transform: translateX(0);
}

/* --- Modal Styling --- */
#modalContainer { /* This is the overlay */
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.6); /* Darker overlay */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10002; /* Highest */
    backdrop-filter: blur(3px);
}
.modal-content {
    background-color: #252525; /* Dark modal background */
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.4);
    min-width: 300px;
    max-width: 90%;
    color: #e0e0e0;
}
.modal-content h2 {
    margin-top: 0;
    color: #ffffff;
    border-bottom: 1px solid #444;
    padding-bottom: 10px;
    font-size: 1.2em;
}
.modal-content .modal-body {
    margin: 15px 0;
    font-size: 0.95em;
    line-height: 1.6;
}
.modal-buttons {
    text-align: right;
    margin-top: 20px;
}
.modal-buttons button {
    padding: 8px 15px;
    margin-left: 10px;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-weight: 500;
}
.modal-buttons button.confirm {
    background-color: #0078D4; /* Windows blue for confirm */
    color: white;
}
.modal-buttons button.confirm:hover {
    background-color: #005ba1;
}
.modal-buttons button.cancel {
    background-color: #555555;
    color: #ffffff;
}
.modal-buttons button.cancel:hover {
    background-color: #666666;
}

/* --- Context Menu Styling --- */
.context-menu {
    position: absolute;
    background-color: rgba(40,40,40,0.97); /* Dark, slightly transparent */
    border: 1px solid #555555;
    box-shadow: 0px 2px 10px rgba(0,0,0,0.3);
    z-index: 10003; /* Even higher than modals for now */
    padding: 5px 0;
    border-radius: 3px;
    backdrop-filter: blur(5px);
    min-width: 180px;
}
.context-menu ul {
    list-style: none; margin: 0; padding: 0;
}
.context-menu li {
    padding: 7px 15px; cursor: pointer; color: #e0e0e0; font-size: 0.85em;
}
.context-menu li:hover {
    background-color: #0078D4; color: white;
}
.context-menu li.disabled {
    color: #888888; cursor: default; background-color: transparent !important;
}
.context-menu hr {
    border: none; border-top: 1px solid #555555; margin: 4px 0;
}

/* --- Knob Styling --- */
.knob-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2px; /* Reduced padding */
    width: 60px; /* Fixed width */
    height: 70px; /* Fixed height */
    font-size: 0.7rem; /* Smaller font */
    color: #b0b0b0;
    text-align: center;
}
.knob-label {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
    margin-bottom: 2px; /* Space between label and knob */
    font-weight: 500;
}
.knob {
    width: 32px; /* Smaller knob */
    height: 32px;
    background-color: #333;
    border-radius: 50%;
    position: relative;
    border: 1px solid #444;
    box-shadow: inset 0 0 3px rgba(0,0,0,0.5);
    cursor: ns-resize; /* Indicate vertical drag for value change */
}
.knob-handle {
    width: 2px;
    height: 40%; /* Slightly shorter handle */
    background-color: #00A8E8; /* Bright blue handle */
    position: absolute;
    bottom: 50%;
    left: 50%;
    transform-origin: bottom center;
    border-radius: 1px;
}
.knob-value {
    margin-top: 3px; /* Space between knob and value */
    color: #e0e0e0;
    font-weight: bold;
}

/* --- Drop Zone Styling --- */
.drop-zone {
    border: 2px dashed #555;
    border-radius: 5px;
    padding: 15px;
    text-align: center;
    color: #888;
    font-size: 0.8em;
    transition: background-color 0.2s ease;
    background-color: rgba(255,255,255,0.03); /* Very subtle background */
}
.drop-zone.dragover {
    background-color: rgba(0, 150, 255, 0.1); /* Highlight on drag over */
    border-color: #00A8E8;
}
.drop-zone p { margin: 5px 0; }
.drop-zone button {
    font-size: 0.9em;
    padding: 3px 8px;
    margin-top: 5px;
    background-color: #444;
    border: 1px solid #666;
    color: #ddd;
    border-radius: 3px;
}
.drop-zone button:hover { background-color: #555; }
.drop-zone .file-info { font-size: 0.9em; margin-top: 5px; }
.drop-zone .status-loaded { color: #4CAF50; /* Green */ }
.drop-zone .status-missing, .drop-zone .status-missing_db { color: #FFC107; /* Amber */ }
.drop-zone .status-error { color: #F44336; /* Red */ }


/* --- Sample Pad and Drum Pad Styling --- */
.sample-pad, .drum-pad {
    background-color: #4a4a4a;
    border: 1px solid #666;
    color: #e0e0e0;
    transition: background-color 0.1s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
}
.sample-pad:hover, .drum-pad:hover {
    background-color: #5a5a5a;
}
.sample-pad:active, .drum-pad:active {
    background-color: #00A8E8; /* Active press color */
    border-color: #007bff;
}
.sample-pad.selected, .drum-pad.selected { /* For selection state in editor */
    border-color: #00A8E8;
    box-shadow: 0 0 5px #00A8E8;
}
.drum-pad.status-missing, .drum-pad.status-error { border: 2px solid red !important; }
.drum-pad.status-missing_db { border: 2px solid orange !important;}


/* --- Sequencer Styling --- */
.sequencer-container {
    background-color: #121212; /* Very dark background for the sequencer itself */
    color: #b0b0b0;
}
.sequencer-container .controls {
    background-color: #1e1e1e; /* Match window background */
    border-bottom-color: #383838; /* Match window border */
    padding: 4px; /* Compact padding */
}
.sequencer-header-cell, .sequencer-label-cell {
    background-color: #2a2a2a; /* Slightly lighter than main sequencer bg */
    border-color: #383838;
    color: #a0a0a0;
    font-weight: 500;
}
.sequencer-step-cell {
    cursor: pointer;
    border-color: #282828; /* Darker grid lines */
    transition: background-color 0.05s ease;
}
.sequencer-step-cell.bg-gray-50 { background-color: #161616 !important; } /* Darker beat block */
.sequencer-step-cell.bg-white { background-color: #191919 !important; } /* Slightly lighter beat block */

.sequencer-step-cell.active-synth { background-color: #3b82f6 !important; } /* Blue */
.sequencer-step-cell.active-sampler { background-color: #10b981 !important; } /* Green */
.sequencer-step-cell.active-drum-sampler { background-color: #ef4444 !important; } /* Red */
.sequencer-step-cell.active-instrument-sampler { background-color: #f59e0b !important; } /* Amber */

.sequencer-step-cell.playing {
    box-shadow: inset 0 0 0 2px #f0f0f0; /* White inner border for playhead */
    animation: pulsePlayingStep 0.5s infinite alternate;
}
@keyframes pulsePlayingStep {
    from { box-shadow: inset 0 0 0 2px #e0e0e0, 0 0 3px #e0e0e0; }
    to { box-shadow: inset 0 0 0 2px #ffffff, 0 0 6px #ffffff; }
}


/* --- Timeline Specific Styling --- */
#timeline-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    background-color: #161616; /* Dark background for the timeline */
    overflow: hidden;
}

#timeline-header {
    height: 20px; /* Height of the ruler */
    background-color: #2a2a2a; /* Dark header background */
    position: relative;
    overflow: hidden; /* Clip ruler content */
    border-bottom: 1px solid #383838;
}

#timeline-ruler {
    position: absolute;
    left: 0; /* Aligns with the start of the track names area */
    top: 0;
    height: 100%;
    width: 4000px; /* Must be as wide as #timeline-tracks-area */
    background-image: 
        repeating-linear-gradient(to right, #555 0, #555 1px, transparent 1px, transparent 100%), /* Major ticks */
        repeating-linear-gradient(to right, #444 0, #444 1px, transparent 1px, transparent 100%); /* Minor ticks */
    background-repeat: repeat-x;
    /* Adjust background-size: first value is tick interval, second is height */
    /* Assuming 120px per bar (4 beats), 30px per beat */
    background-size: 120px 100%, 30px 100%; 
    color: #aaa;
    font-size: 10px;
    /* Labels will need to be added via JS or more complex CSS if dynamic */
}


#timeline-tracks-container {
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: hidden; /* Let .window-content handle main scroll */
    position: relative;
    width: 100%;
}

#timeline-tracks-area {
    width: 4000px; /* Arbitrary large width, ensure it's wider than viewport */
    position: relative;
}

.timeline-track-lane {
    height: 50px;
    background-color: #1e1e1e;
    border-bottom: 1px solid #2a2a2a;
    box-sizing: border-box;
    position: relative; /* For absolute positioning of clips */
    overflow: hidden; /* Clips should not overflow lane height */
    display: flex; /* To align name and clips container */
    align-items: center;
}
.timeline-track-lane:nth-child(even) {
    background-color: #1a1a1a; /* Slightly different for alternate rows */
}
.timeline-track-lane-name {
    position: sticky; /* Make track names sticky to the left */
    left: 0;
    z-index: 2; /* Above clips but below playhead */
    background-color: #2f2f2f; /* Distinct background for name area */
    padding: 0 8px;
    height: 100%;
    display: flex;
    align-items: center;
    border-right: 1px solid #3a3a3a;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 120px; /* Consistent width */
    max-width: 120px; /* Consistent width */
    font-size: 0.8rem;
    font-weight: 500;
}

#timeline-playhead {
    position: absolute;
    top: 0; /* Starts from the top of the timeline-header */
    bottom: 0; /* Spans the entire height of the timeline window content */
    width: 2px;
    background-color: #ff4500; /* Bright color for visibility */
    z-index: 10; /* Above tracks and clips */
    pointer-events: none; /* Allow clicks to pass through */
    left: 120px; /* Initial offset for track names, JS will update */
    display: none; /* Hidden by default, shown in timeline mode */
}

.audio-clip {
    position: absolute;
    height: 80%; /* Or a fixed pixel height like 36px */
    top: 10%;
    background-color: #007bff; /* Blue for audio clips */
    border: 1px solid #0056b3;
    border-radius: 3px;
    color: white;
    font-size: 0.75rem;
    padding: 0 5px;
    display: flex;
    align-items: center;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    box-sizing: border-box;
    cursor: grab;
}
.audio-clip:active {
    cursor: grabbing;
}

.sequence-clip {
    background-color: #28a745; /* Green for sequence clips */
    border-color: #1e7e34;
}

.timeline-track-lane.dragover-timeline-lane {
    background-color: #2c3e50 !important; /* Highlight for drop target */
}

/* MODIFICATION START: Styles for selected clips and resize handles */
.timeline-clip.timeline-clip-selected {
    border: 2px solid #00A8E8; /* A bright blue for selected state */
    /* background-color: #0090C0; */ /* Optional: Slightly darker shade for audio */
}

.timeline-clip.sequence-clip.timeline-clip-selected {
    /* background-color: #00A0A0; */ /* Optional: Slightly different for sequence clips */
    border: 2px solid #00E8A8; /* A greenish-blue for selected sequence clips */
}

.timeline-clip-resize-handle {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 8px; /* Make them a bit easier to grab */
    background-color: rgba(0, 168, 232, 0.6); /* Semi-transparent blue */
    z-index: 5; /* Ensure they are above the clip content but below playhead if it overlaps */
}

.timeline-clip-resize-handle.resize-handle-left {
    left: -4px; /* Position half in, half out */
    cursor: ew-resize; /* East-West resize cursor */
    border-top-left-radius: 3px;
    border-bottom-left-radius: 3px;
}

.timeline-clip-resize-handle.resize-handle-right {
    right: -4px; /* Position half in, half out */
    cursor: ew-resize;
    border-top-right-radius: 3px;
    border-bottom-right-radius: 3px;
}
/* MODIFICATION END */
