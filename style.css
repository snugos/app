/* js/style.css - SnugOS Stylesheet with Light/Dark Theme */

/* --- CSS Custom Properties for Theming --- */
:root {
    /* Light Theme (Default) */
    --font-family: 'Inter', sans-serif;
    
    --bg-base: #f0f2f5; /* Very light gray, almost white */
    --bg-desktop: #e9ecef; /* Slightly darker light gray for desktop */
    --bg-window: #ffffff; /* White for windows */
    --bg-window-title-bar: #f8f9fa; /* Very light gray for title bars */
    --bg-window-content: #ffffff; /* White for window content area */
    --bg-taskbar: #dee2e6; /* Light gray for taskbars */
    --bg-start-menu: #ffffff;
    --bg-button: #e9ecef;
    --bg-button-hover: #ced4da;
    --bg-button-active: #adb5bd;
    --bg-input: #ffffff;
    --bg-input-focus: #ffffff;
    --bg-dropzone: #f8f9fa;
    --bg-dropzone-dragover: #e9ecef;
    --bg-pad-button: #f1f3f5;
    --bg-pad-button-hover: #e9ecef;
    --bg-pad-button-active: #dee2e6;
    --bg-sequencer-grid: #f8f9fa; /* Light background for sequencer grid */
    --bg-sequencer-header: #e9ecef;
    --bg-sequencer-label: #e9ecef;
    --bg-sequencer-step-light: #ffffff;
    --bg-sequencer-step-dark: #f1f3f5;
    --bg-sequencer-step-hover: #dbe4ff; /* Light blue hover */
    --bg-modal-overlay: rgba(0, 0, 0, 0.4);
    --bg-modal-dialog: #ffffff;
    --bg-modal-title-bar: #f1f3f5;
    --bg-context-menu: #ffffff;
    --bg-context-menu-hover: #007bff; /* Blue hover for context menu */
    --bg-waveform: #ffffff;
    --bg-meter-container: #e9ecef;


    --text-primary: #212529; /* Dark gray for primary text */
    --text-secondary: #495057; /* Medium gray for secondary text */
    --text-muted: #6c757d; /* Lighter gray for muted text */
    --text-title-bar: #000000;
    --text-button: #212529;
    --text-button-hover: #000000;
    --text-input: #212529;
    --text-placeholder: #6c757d;
    --text-pad-label: #495057;
    --text-sequencer-header: #495057;
    --text-sequencer-label: #343a40;
    --text-sequencer-step: #6c757d;
    --text-context-menu: #212529;
    --text-context-menu-hover: #ffffff;
    --text-context-menu-disabled: #adb5bd;


    --border-primary: #ced4da; /* Default border color */
    --border-window: #adb5bd; 
    --border-window-title-bar: #ced4da;
    --border-button: #adb5bd;
    --border-button-active: #6c757d;
    --border-input: #ced4da;
    --border-input-focus: #80bdff; /* Blue focus like Bootstrap */
    --border-dropzone: #adb5bd;
    --border-dropzone-dragover: #007bff;
    --border-pad-button: #ced4da;
    --border-pad-button-selected: #007bff;
    --border-sequencer: #dee2e6;
    --border-modal: #adb5bd;
    --border-context-menu: #ced4da;
    --border-context-menu-separator: #e9ecef;
    --border-meter-container: #adb5bd;

    --shadow-window: 0px 2px 10px rgba(0,0,0,0.1);
    --shadow-start-menu: 2px 2px 8px rgba(0,0,0,0.15);
    --shadow-modal: 0px 5px 15px rgba(0,0,0,0.2);
    --shadow-context-menu: 1px 1px 5px rgba(0,0,0,0.1);
    --shadow-button-inset: inset 0 1px 1px rgba(255,255,255,0.6), inset 0 -1px 1px rgba(0,0,0,0.1);
    --shadow-button-active-inset: inset 0 1px 2px rgba(0,0,0,0.2), inset 0 -1px 0 rgba(255,255,255,0.3);


    --accent-primary: #007bff; /* Blue */
    --accent-secondary: #6c757d; /* Gray */
    --accent-success: #28a745; /* Green */
    --accent-danger: #dc3545; /* Red */
    --accent-warning: #ffc107; /* Yellow */
    --accent-info: #17a2b8; /* Teal */

    --sequencer-active-synth: #007bff; 
    --sequencer-active-sampler: #17a2b8;
    --sequencer-active-drum: #28a745;
    --sequencer-active-instrument: #fd7e14; /* Orange */
    --sequencer-playing-outline: #ffc107;

    --waveform-color: var(--accent-primary);
    --meter-bar-color: var(--accent-info);
    --meter-bar-clipping-color: var(--accent-danger);

    --scrollbar-thumb: #adb5bd;
    --scrollbar-thumb-hover: #6c757d;
    --scrollbar-track: #e9ecef;

    /* Specific component variables */
    --timeline-track-name-width: 120px;
    --timeline-track-name-bg: #f8f9fa; /* Light gray for track names in light mode */
    --timeline-border-color: #ced4da;
    --timeline-ruler-bg: #e9ecef;
    --timeline-ruler-line-major: #adb5bd;
    --timeline-ruler-line-minor: #ced4da;
    --timeline-track-bg-odd: #f8f9fa;
    --timeline-track-bg-even: #ffffff;
    --timeline-playhead-color: var(--accent-danger);
    --audio-clip-bg: var(--accent-info);
    --audio-clip-border: #117a8b; /* Darker teal */
    --sequence-clip-bg: #007bff; /* Blue */
    --sequence-clip-border: #0056b3; /* Darker blue */

}

html.dark {
    /* Dark Theme Overrides */
    --bg-base: #121212; /* Very dark gray (almost black) */
    --bg-desktop: #181818; /* Slightly lighter dark gray */
    --bg-window: #1e1e1e; /* Main window background - very dark grey */
    --bg-window-title-bar: #2a2a2a; /* Slightly lighter for definition */
    --bg-window-content: #181818; /* Main content area - very dark */
    --bg-taskbar: #1a1a1a; /* Dark taskbar */
    --bg-start-menu: #1e1e1e;
    --bg-button: #3a3a3a;
    --bg-button-hover: #4a4a4a;
    --bg-button-active: #2a2a2a;
    --bg-input: #282828;
    --bg-input-focus: #303030;
    --bg-dropzone: #1c1c1c;
    --bg-dropzone-dragover: #2a2a2a;
    --bg-pad-button: #282828;
    --bg-pad-button-hover: #3a3a3a;
    --bg-pad-button-active: #202020;
    --bg-sequencer-grid: #121212; 
    --bg-sequencer-header: #1c1c1c;
    --bg-sequencer-label: #1c1c1c;
    --bg-sequencer-step-light: #161616; 
    --bg-sequencer-step-dark: #1e1e1e;  
    --bg-sequencer-step-hover: #2c2c2c; 
    --bg-modal-overlay: rgba(0,0,0,0.75);
    --bg-modal-dialog: #1e1e1e;
    --bg-modal-title-bar: #2a2a2a;
    --bg-context-menu: #2a2a2a;
    --bg-context-menu-hover: #0060c0; /* Brighter blue hover */
    --bg-waveform: #101010;
    --bg-meter-container: #101010;

    --text-primary: #e0e0e0; /* Light gray default text */
    --text-secondary: #b0b0b0;
    --text-muted: #888888;
    --text-title-bar: #f0f0f0; /* Bright white text for title */
    --text-button: #e0e0e0;
    --text-button-hover: #ffffff;
    --text-input: #e0e0e0;
    --text-placeholder: #777777;
    --text-pad-label: #b0b0b0;
    --text-sequencer-header: #b0b0b0;
    --text-sequencer-label: #c0c0c0;
    --text-sequencer-step: #777777;
    --text-context-menu: #e0e0e0;
    --text-context-menu-hover: #ffffff;
    --text-context-menu-disabled: #555555;

    --border-primary: #3a3a3a;
    --border-window: #383838; 
    --border-window-title-bar: #121212; /* Darker separator line */
    --border-button: #1a1a1a;
    --border-button-active: #121212;
    --border-input: #4a4a4a;
    --border-input-focus: #60a5fa; /* Lighter blue focus */
    --border-dropzone: #4a4a4a;
    --border-dropzone-dragover: #5a5a5a;
    --border-pad-button: #404040;
    --border-pad-button-selected: #60a5fa;
    --border-sequencer: #2a2a2a;
    --border-modal: #3a3a3a;
    --border-context-menu: #484848;
    --border-context-menu-separator: #3a3a3a;
    --border-meter-container: #3a3a3a;

    --shadow-window: 0px 0px 15px rgba(0,0,0,0.5);
    --shadow-start-menu: 2px 2px 8px rgba(0,0,0,0.6);
    --shadow-modal: 2px 2px 10px rgba(0,0,0,0.7);
    --shadow-context-menu: 2px 2px 8px rgba(0,0,0,0.6);
    --shadow-button-inset: inset -1px -1px 1px rgba(0,0,0,0.3), inset 1px 1px 1px rgba(255,255,255,0.05);
    --shadow-button-active-inset: inset 1px 1px 1px rgba(0,0,0,0.4), inset -1px -1px 1px rgba(255,255,255,0.03);


    --accent-primary: #3b82f6; /* Blue-500 */
    --accent-secondary: #6b7280; /* Gray-500 */
    --accent-success: #10b981; /* Emerald-500 */
    --accent-danger: #ef4444; /* Red-500 */
    --accent-warning: #f59e0b; /* Amber-500 */
    --accent-info: #06b6d4; /* Cyan-500 */

    --sequencer-active-synth: #0ea5e9; /* sky-500 */
    --sequencer-active-sampler: #14b8a6; /* teal-500 */
    --sequencer-active-drum: #22c55e; /* green-500 */
    --sequencer-active-instrument: #f97316; /* orange-500 */
    --sequencer-playing-outline: #eab308; /* yellow-500 */

    --waveform-color: var(--accent-info);
    --meter-bar-color: var(--accent-info);
    --meter-bar-clipping-color: var(--accent-danger);

    --scrollbar-thumb: #4a4a4a;
    --scrollbar-thumb-hover: #5a5a5a;
    --scrollbar-track: #1e1e1e;

    --timeline-track-name-bg: #2a2a2a;
    --timeline-border-color: #3a3a3a;
    --timeline-ruler-bg: #2a2a2a;
    --timeline-ruler-line-major: #555555;
    --timeline-ruler-line-minor: #444444;
    --timeline-track-bg-odd: #1e1e1e;
    --timeline-track-bg-even: #1a1a1a;
    --timeline-playhead-color: #00ffff; /* Cyan */
    --audio-clip-bg: #008080; /* Teal */
    --audio-clip-border: #009090; /* Slightly lighter teal */
    --sequence-clip-bg: #007acc; /* Darker blue */
    --sequence-clip-border: #005fa3;
}


/* --- SnugOS General & Desktop Styling --- */
body {
    font-family: var(--font-family); 
    font-size: 14px;
    margin: 0; 
    overflow: hidden; 
    background-color: var(--bg-base); 
    color: var(--text-primary); 
    transition: background-color 0.3s ease, color 0.3s ease;
}

#desktop {
    width: 100vw;
    height: 100vh;
    overflow: hidden; 
    position: relative; 
    background-color: var(--bg-desktop); 
    /* Default padding for taskbars, can be overridden if taskbars are different heights */
    padding-top: 32px;  /* Height of topTaskbar */
    padding-bottom: 32px; /* Height of bottom taskbar */
    box-sizing: border-box;
}

/* --- Window Styling --- */
.window {
    position: absolute; 
    border: 1px solid var(--border-window); 
    box-shadow: var(--shadow-window); 
    background-color: var(--bg-window); 
    display: flex; 
    flex-direction: column; 
    overflow: hidden; 
    min-width: 150px; 
    min-height: 100px;
    color: var(--text-primary); 
    border-radius: 4px; /* Slightly more rounded */
}

.window.minimized {
    display: none !important; 
}

.window-title-bar {
    background-color: var(--bg-window-title-bar); 
    color: var(--text-title-bar); 
    padding: 6px 10px; /* Increased padding */
    cursor: grab;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 30px; /* Standard height */
    flex-shrink: 0; 
    font-size: 0.9rem; 
    font-weight: 600; /* Semibold */
    user-select: none; 
    border-bottom: 1px solid var(--border-window-title-bar); 
    border-top-left-radius: 3px; /* Match window rounding */
    border-top-right-radius: 3px;
}

.window-title-bar span { 
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding-right: 8px; 
}

.window-title-buttons {
    display: flex;
    gap: 4px; /* Space between buttons */
}

.window-title-buttons button {
    background: var(--bg-button); 
    border: 1px solid var(--border-button); 
    color: var(--text-button); 
    width: 22px; 
    height: 22px;
    line-height: 20px; 
    text-align: center;
    font-size: 12px; /* Slightly larger */
    font-weight: bold;
    padding: 0;
    cursor: default; /* Standard cursor */
    flex-shrink: 0;
    border-radius: 3px; 
    transition: background-color 0.15s ease, color 0.15s ease, border-color 0.15s ease;
}

.window-title-buttons button:hover {
    background: var(--bg-button-hover); 
    color: var(--text-button-hover);
    border-color: var(--border-button-active);
}

.window-title-buttons button:active {
    background: var(--bg-button-active); 
    border-color: var(--border-button-active);
    box-shadow: var(--shadow-button-active-inset);
}

.window-content {
    flex-grow: 1; 
    padding: 0; 
    background-color: var(--bg-window-content); 
    overflow: auto; 
    color: var(--text-primary); 
}

/* --- Taskbar Styling (Top and Bottom) --- */
#taskbar, #topTaskbar {
    position: fixed;
    left: 0;
    width: 100%;
    height: 32px; 
    background-color: var(--bg-taskbar); 
    z-index: 10000; 
    display: flex;
    align-items: center;
    padding: 0 6px;
    box-sizing: border-box;
    color: var(--text-secondary); 
}
#taskbar { /* Bottom taskbar specific */
    bottom: 0;
    border-top: 1px solid var(--border-primary); 
}
#topTaskbar { /* Top taskbar specific */
    top: 0;
    border-bottom: 1px solid var(--border-primary);
    justify-content: space-between; /* For controls on left, theme on right */
}

/* Theme Toggle Buttons in Top Taskbar */
#topTaskbar #themeToggleLight,
#topTaskbar #themeToggleDark {
    background: none;
    border: none;
    padding: 4px; /* Adjust padding for icon size */
    border-radius: 50%;
    cursor: pointer;
    color: var(--text-secondary);
    transition: background-color 0.2s ease, color 0.2s ease;
}
#topTaskbar #themeToggleLight:hover,
#topTaskbar #themeToggleDark:hover {
    background-color: var(--bg-button-hover);
    color: var(--text-button-hover);
}
html.dark #themeToggleDark,
html:not(.dark) #themeToggleLight {
    background-color: var(--accent-primary); /* Highlight active theme button */
    color: white; /* Or a contrasting color for the active icon */
}


#startButton {
    background-color: var(--bg-button); 
    border: 1px solid var(--border-button);
    box-shadow: var(--shadow-button-inset);
    padding: 4px 12px; 
    font-weight: 600; 
    margin-right: 6px;
    color: var(--text-button); 
    border-radius: 3px;
    transition: background-color 0.15s ease;
}
#startButton:hover {
    background-color: var(--bg-button-hover);
}
#startButton:active {
    border-color: var(--border-button-active); 
    box-shadow: var(--shadow-button-active-inset);
    background-color: var(--bg-button-active);
}

#taskbarButtons .taskbar-button {
    background-color: var(--bg-button); 
    border: 1px solid var(--border-button);
    box-shadow: var(--shadow-button-inset);
    padding: 3px 10px; 
    margin: 0 3px;
    max-width: 160px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-size: 0.8rem;
    flex-shrink: 0; 
    color: var(--text-secondary); 
    border-radius: 3px;
    transition: background-color 0.15s ease, color 0.15s ease, box-shadow 0.15s ease;
}
#taskbarButtons .taskbar-button:hover {
    background-color: var(--bg-button-hover);
    color: var(--text-button-hover);
}
#taskbarButtons .taskbar-button.active,
#taskbarButtons .taskbar-button:active {
    border-color: var(--border-button-active);
    box-shadow: var(--shadow-button-active-inset);
    background-color: var(--bg-button-active); 
    color: var(--text-button-hover); 
}
#taskbarButtons .taskbar-button.minimized-on-taskbar {
    background-color: var(--bg-button); 
    opacity: 0.65; 
}

#taskbarTempoDisplay {
    margin-left: auto; 
    padding: 4px 10px;
    border: 1px solid var(--border-button);
    box-shadow: var(--shadow-button-inset);
    font-size: 0.8rem;
    background-color: var(--bg-button); 
    cursor: pointer;
    color: var(--text-secondary); 
    border-radius: 3px;
}
#taskbarTempoDisplay:hover {
    background-color: var(--bg-button-hover);
}

/* --- Start Menu Styling --- */
#startMenu {
    position: absolute;
    bottom: 32px; 
    left: 0;
    background: var(--bg-start-menu); 
    border: 1px solid var(--border-primary); 
    box-shadow: var(--shadow-start-menu);
    z-index: 10001; 
    padding: 4px; 
    min-width: 220px; 
    color: var(--text-primary); 
    border-radius: 4px; /* Match window rounding */
}

#startMenu.hidden { display: none; }
#startMenu ul { list-style: none; padding: 0; margin: 0; }
#startMenu li { padding: 7px 20px 7px 12px; cursor: pointer; font-size: 0.9rem; white-space: nowrap; color: var(--text-primary); border-radius: 3px; transition: background-color 0.1s ease, color 0.1s ease;}
#startMenu li:hover, #startMenu li.disabled:hover { background: var(--bg-context-menu-hover); color: var(--text-context-menu-hover); } 
#startMenu li.disabled { color: var(--text-context-menu-disabled); cursor: default; }
#startMenu hr { border: none; border-top: 1px solid var(--border-context-menu-separator); margin: 4px 0; }


/* --- Pad Button Styling --- */
.pad-button {
    padding: 8px;
    border: 1px solid var(--border-pad-button); 
    background-color: var(--bg-pad-button); 
    color: var(--text-secondary); 
    cursor: pointer;
    text-align: center;
    min-width: 70px; 
    min-height: 70px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-button-inset);
    transition: background-color 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    overflow: hidden; 
    position: relative; 
    border-radius: 3px;
}
.pad-button:hover {
    background-color: var(--bg-pad-button-hover); 
}
.pad-button:active, .pad-button.selected-for-edit {
    background-color: var(--bg-pad-button-active); 
    box-shadow: var(--shadow-button-active-inset);
    border-color: var(--border-pad-button);
}
.pad-button.selected-for-edit {
    border-color: var(--border-pad-button-selected); 
    border-width: 2px;
    padding: 7px; 
}
.pad-label {
    font-size: 0.65rem; 
    color: var(--text-muted); 
    display: block;
    margin-top: 5px;
    word-break: break-all; 
    line-height: 1.2;
    max-height: 2.4em; 
    overflow: hidden;
    text-overflow: ellipsis;
}

/* --- General Drop Zone Styling --- */
.drop-zone {
    border: 2px dashed var(--border-dropzone); 
    padding: 10px;          
    text-align: center;
    background-color: var(--bg-dropzone);  
    color: var(--text-muted);            
    font-size: 0.8em; 
    border-radius: 4px;         
    margin-bottom: 5px;    
    transition: background-color 0.2s ease, border-color 0.2s ease;
}
.drop-zone.dragover {
    background-color: var(--bg-dropzone-dragover); 
    border-color: var(--border-dropzone-dragover);     
    color: var(--text-primary); 
}
.drop-zone label { color: var(--accent-primary); text-decoration: underline; cursor: pointer; }
.drop-zone label:hover { color: var(--accent-primary); filter: brightness(1.2); }


/* --- Knob Styling --- */
.knob-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 5px; 
    min-width: 60px; 
}
.knob-label {
    font-size: 0.7rem; 
    color: var(--text-secondary); 
    margin-bottom: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    text-align: center;
}
.knob {
    width: 36px; 
    height: 36px; 
    background-color: var(--bg-button); 
    border-radius: 50%;
    position: relative;
    border: 1px solid var(--border-button); 
    box-shadow: var(--shadow-button-inset);
    cursor: ns-resize; 
}
.knob-handle {
    width: 4px; 
    height: 10px; 
    background-color: var(--text-muted); 
    position: absolute;
    top: 3px; 
    left: 50%;
    transform: translateX(-50%); 
    transform-origin: bottom center; 
    border-radius: 2px; 
}
.knob-value {
    font-size: 0.65rem; 
    color: var(--text-muted); 
    margin-top: 2px;
    min-height: 1em; 
    text-align: center;
}

/* --- General Button Active States --- */
button.muted { background-color: var(--accent-danger) !important; color: white !important; }
button.soloed { background-color: var(--accent-warning) !important; color: var(--text-primary) !important; }
button.armed { background-color: var(--accent-danger) !important; filter: brightness(1.2); color: white !important; }
button.active { background-color: var(--accent-primary) !important; color: white !important; }

/* --- Sequencer Grid Styling --- */
.sequencer-container .controls { 
    position: sticky;
    top: 0;
    left: 0; 
    background-color: var(--bg-window-title-bar); /* Match window title bar */
    z-index: 30; 
    border-bottom: 1px solid var(--border-window-title-bar);
    padding: 0.25rem; 
    color: var(--text-title-bar); 
}
.sequencer-container .controls input,
.sequencer-container .controls label {
    color: var(--text-input); 
}
.sequencer-container .controls input {
    background-color: var(--bg-input); 
    border-color: var(--border-input);
}

.sequencer-grid-layout {
    background-color: var(--bg-sequencer-grid); 
}

.sequencer-grid-layout > div {
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-size: 0.65rem; 
    border: 1px solid var(--border-sequencer); 
}

.sequencer-grid-layout .sequencer-header-cell {
    position: sticky;
    top: 0;
    background-color: var(--bg-sequencer-header); 
    font-weight: 500;
    color: var(--text-sequencer-header); 
    z-index: 20; 
}
.sequencer-grid-layout .sequencer-header-cell:first-child { 
    z-index: 25; 
    left: 0; 
}

.sequencer-grid-layout .sequencer-label-cell {
    position: sticky;
    left: 0;
    background-color: var(--bg-sequencer-label); 
    justify-content: flex-end;
    padding-right: 0.25rem; 
    font-weight: 500;
    color: var(--text-sequencer-label); 
    z-index: 10; 
}

.sequencer-grid-layout .sequencer-step-cell {
    cursor: pointer;
    transition: background-color 0.1s ease;
    color: var(--text-sequencer-step); 
}

.sequencer-step-cell.bg-gray-50 { background-color: var(--bg-sequencer-step-light); } 
.sequencer-step-cell.bg-white { background-color: var(--bg-sequencer-step-dark); }  

.sequencer-step-cell:hover {
    background-color: var(--bg-sequencer-step-hover) !important; 
}

.sequencer-step-cell.active-synth { background-color: var(--sequencer-active-synth) !important; color: white !important; }
.sequencer-step-cell.active-sampler { background-color: var(--sequencer-active-sampler) !important; color: white !important; }
.sequencer-step-cell.active-drum-sampler { background-color: var(--sequencer-active-drum) !important; color: white !important; }
.sequencer-step-cell.active-instrument-sampler { background-color: var(--sequencer-active-instrument) !important; color: white !important; } 

.sequencer-step-cell.playing {
    outline: 2px solid var(--sequencer-playing-outline); 
    outline-offset: -2px;
    z-index: 5; 
}

/* --- Notification Area --- */
#notification-area { 
    position: fixed;
    top: 40px; /* Below top taskbar */
    right: 10px;
    z-index: 20000; /* High z-index */
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.notification-message { 
    background-color: rgba(0,0,0,0.75); /* Darker for better contrast on light/dark */
    color: white;
    padding: 10px 15px;
    border-radius: 4px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    opacity: 0;
    transform: translateY(-20px);
    transition: opacity 0.3s ease, transform 0.3s ease;
    font-size: 0.85rem;
    max-width: 300px;
}
.notification-message.show { 
    opacity: 1;
    transform: translateY(0);
}

/* --- Waveform Canvas --- */
.waveform-canvas { 
    border: 1px solid var(--border-primary);
    background-color: var(--bg-waveform); 
    width: 100%; 
    height: 70px; 
    display: block; 
}

/* --- Meter Bar Styling --- */
.meter-bar-container { 
    background-color: var(--bg-meter-container); 
    border-radius: 3px;
    overflow: hidden;
    border: 1px solid var(--border-meter-container);
    height: 10px; 
    box-sizing: border-box;
}
.meter-bar {
    background-color: var(--meter-bar-color); 
    height: 100%;
    width: 0%;
    transition: width 0.05s linear;
}
.meter-bar.clipping {
    background-color: var(--meter-bar-clipping-color); 
}
.track-meter-container { height: 16px; margin-top: 2px; }
.mixer-meter-container { height: 12px; margin-top: 4px; }
#masterMeterContainerGlobal, #mixerMasterMeterContainer { height: 15px; }

/* Modal Styling */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: var(--bg-modal-overlay); 
    display: flex; justify-content: center; align-items: center;
    z-index: 15000; 
}
.modal-dialog {
    background-color: var(--bg-modal-dialog); 
    border: 1px solid var(--border-modal); 
    box-shadow: var(--shadow-modal);
    min-width: 300px; max-width: 90%; max-height: 90vh;
    display: flex; flex-direction: column;
    color: var(--text-primary); 
    border-radius: 4px; 
}
.modal-title-bar {
    background-color: var(--bg-modal-title-bar); 
    color: var(--text-title-bar);
    padding: 8px 12px; 
    font-weight: bold; font-size: 1rem; user-select: none;
    border-bottom: 1px solid var(--border-primary); 
    border-top-left-radius: 3px; 
    border-top-right-radius: 3px;
}
.modal-content-body { /* Renamed from .modal-content to avoid conflict with SnugWindow */
    padding: 15px; overflow-y: auto; flex-grow: 1;
    background-color: var(--bg-modal-dialog); 
    color: var(--text-primary); 
}
.modal-content-body p { margin-bottom: 10px; }
.modal-content-body p:last-child { margin-bottom: 0; }

.modal-buttons {
    padding: 10px 15px; text-align: right;
    border-top: 1px solid var(--border-primary); 
    background-color: var(--bg-modal-dialog);
    border-bottom-left-radius: 3px;
    border-bottom-right-radius: 3px;
}
.modal-buttons button {
    background-color: var(--bg-button);
    border: 1px solid var(--border-button);
    box-shadow: var(--shadow-button-inset);
    color: var(--text-button);
    padding: 6px 15px; 
    margin-left: 10px; cursor: pointer; font-size: 0.85rem;
    border-radius: 3px;
    transition: background-color 0.15s ease;
}
.modal-buttons button:hover {
    background-color: var(--bg-button-hover);
}
.modal-buttons button:active {
    border-color: var(--border-button-active); 
    box-shadow: var(--shadow-button-active-inset);
    background-color: var(--bg-button-active);
}
.modal-buttons button.confirm {
    background-color: var(--accent-primary);
    color: white;
}
.modal-buttons button.confirm:hover {
    background-color: var(--accent-primary);
    filter: brightness(1.1);
}


/* Input and Select Styling */
select, input[type="text"], input[type="number"],
.window-content select, .modal-content-body select,
.window-content input[type="text"], .window-content input[type="number"],
.modal-content-body input[type="text"], .modal-content-body input[type="number"] {
    background-color: var(--bg-input); 
    color: var(--text-input); 
    border: 1px solid var(--border-input); 
    padding: 6px 10px; 
    border-radius: 3px;
    font-size: 0.85rem; 
    transition: border-color 0.15s ease, box-shadow 0.15s ease;
}
select:focus, input[type="text"]:focus, input[type="number"]:focus,
.window-content select:focus, .modal-content-body select:focus,
.window-content input[type="text"]:focus, .window-content input[type="number"]:focus,
.modal-content-body input[type="text"]:focus, .modal-content-body input[type="number"]:focus {
    border-color: var(--border-input-focus);
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25); /* Bootstrap-like focus glow */
}

input::placeholder, 
.window-content input::placeholder, .modal-content-body input::placeholder {
    color: var(--text-placeholder); 
}

/* Custom Scrollbar Styling */
::-webkit-scrollbar {
    width: 10px; 
    height: 10px; 
}
::-webkit-scrollbar-track {
    background: var(--scrollbar-track); 
    border-radius: 0px; 
}
::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb); 
    border-radius: 2px; 
    border: 1px solid var(--scrollbar-track); 
}
::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover); 
}
::-webkit-scrollbar-corner {
    background: var(--scrollbar-track); 
}
* { /* Firefox scrollbar styling */
  scrollbar-width: thin; 
  scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track); 
}

/* --- Context Menu Styling --- */
.context-menu {
    background-color: var(--bg-context-menu); 
    border: 1px solid var(--border-context-menu);   
    box-shadow: var(--shadow-context-menu);
    padding: 4px 0;
    min-width: 180px;
    border-radius: 4px; /* Match window rounding */
    color: var(--text-context-menu); 
    position: absolute; 
}

.context-menu ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.context-menu-item {
    padding: 7px 15px 7px 12px; 
    cursor: pointer;
    font-size: 0.85rem;
    white-space: nowrap;
    transition: background-color 0.1s ease, color 0.1s ease;
}

.context-menu-item:not(.disabled):hover {
    background-color: var(--bg-context-menu-hover); 
    color: var(--text-context-menu-hover);
}

.context-menu-item.disabled {
    color: var(--text-context-menu-disabled); 
    cursor: default;
}

.context-menu-separator {
    border: none;
    border-top: 1px solid var(--border-context-menu-separator); 
    margin: 4px 0;
}

/* --- Timeline Styling --- */
#timeline-container {
    height: 100%; 
    width: 100%;
    background-color: var(--bg-window-content); /* Use window content background */
    display: flex;
    flex-direction: column;
    overflow: hidden; 
    position: relative;
}

#timeline-header {
    height: 24px; /* Slightly taller for better ruler visibility */
    background-color: var(--timeline-ruler-bg);
    border-bottom: 1px solid var(--timeline-border-color);
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
    width: 100%;
}

#timeline-ruler {
    width: 4000px; /* Keep large width for scrolling */
    height: 100%;
    background-image:
        repeating-linear-gradient(to right, var(--timeline-ruler-line-major) 0 1px, transparent 1px 100%),
        repeating-linear-gradient(to right, var(--timeline-ruler-line-minor) 0 1px, transparent 1px 100%);
    /* Adjust background-size based on pixelsPerSecond and desired markings */
    /* Example: 120px for major (e.g., 1 bar at 120BPM, 30px/sec -> 4sec/bar), 30px for minor (e.g., 1 beat) */
    background-size: 120px 100%, 30px 100%; 
    background-position: left top; /* Align with timeline content */
    position: absolute;
    top: 0;
    left: 0; /* Will be adjusted by JS for track name area */
    /* Add text markings for numbers via JS or more complex CSS if needed */
}

#timeline-tracks-container {
    flex-grow: 1;
    overflow: auto; /* Allow both x and y scroll */
    position: relative;
    width: 100%;
    background-color: var(--bg-desktop); /* Match desktop for empty space */
}

#timeline-tracks-area {
    width: 4000px; /* Keep large width */
    position: relative;
    min-height: 100%; /* Ensure it fills vertically */
}

.timeline-track-lane {
    height: 64px; /* Increased height for better clip visibility */
    border-bottom: 1px solid var(--timeline-border-color);
    box-sizing: border-box;
    position: relative;
    overflow: hidden; /* Clips are absolutely positioned within */
    display: flex; /* For name area and clips container */
    align-items: stretch; /* Make children fill height */
}
.timeline-track-lane:nth-child(odd) {
    background-color: var(--timeline-track-bg-odd);
}
.timeline-track-lane:nth-child(even) {
    background-color: var(--timeline-track-bg-even);
}

.timeline-track-lane-name-area { /* New class for the name area container */
    position: sticky;
    left: 0;
    z-index: 2;
    background-color: var(--timeline-track-name-bg);
    padding: 0 8px;
    height: 100%;
    display: flex;
    flex-direction: column; /* Stack name and sequence buttons */
    align-items: flex-start;
    justify-content: center;
    border-right: 1px solid var(--timeline-border-color);
    min-width: var(--timeline-track-name-width);
    max-width: var(--timeline-track-name-width);
    box-sizing: border-box;
}
.timeline-track-name-text { /* For the track name itself */
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
}
.timeline-sequence-buttons { /* Container for sequence drag buttons */
    margin-top: 4px;
}


#timeline-playhead {
    position: absolute;
    top: 0; /* Starts at the top of the #timeline-container */
    /* left is set by JS, relative to #timeline-container, considering track name width and scroll */
    width: 2px;
    height: 100%; /* Spans header and tracks area */
    background-color: var(--timeline-playhead-color);
    z-index: 40; /* High z-index to be on top of everything */
    pointer-events: none;
}

.audio-clip, .sequence-clip { /* Shared styles for clips */
    position: absolute;
    height: 80%;
    top: 10%;
    border-radius: 3px;
    box-sizing: border-box;
    overflow: hidden;
    color: white;
    font-size: 11px;
    padding: 2px 4px;
    white-space: nowrap;
    text-overflow: ellipsis;
    cursor: grab;
    box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
}
.audio-clip {
    background-color: var(--audio-clip-bg);
    border: 1px solid var(--audio-clip-border);
}
.sequence-clip {
    background-color: var(--sequence-clip-bg);
    border: 1px solid var(--sequence-clip-border);
}
.audio-clip.dragging, .sequence-clip.dragging {
    opacity: 0.7;
    z-index: 50 !important; /* Ensure dragged clip is on top */
}


/* Ensure .window-content for timeline has no padding if timeline-container handles it */
#window-timeline .window-content {
    padding: 0;
}

/* Ensure SnugWindow can take full height if needed */
.window.maximized #timeline-container,
.window.maximized #timeline-tracks-container {
    height: 100%;
}

/* Global control indicators in top taskbar */
#topTaskbar #midiIndicatorGlobal.active, 
#topTaskbar #keyboardIndicatorGlobal.active {
    background-color: var(--accent-info) !important;
    color: white !important;
}

/* Fix for SnugWindow to respect top taskbar */
/* This might need adjustment in SnugWindow.js positioning logic too */
#desktop > .window {
    /* Max height calculation should be done in JS, but CSS can provide a fallback */
    max-height: calc(100vh - var(--top-taskbar-height, 32px) - var(--bottom-taskbar-height, 32px) - 10px); /* 10px for margins */
}

:root {
    --top-taskbar-height: 32px;
    --bottom-taskbar-height: 32px;
}

